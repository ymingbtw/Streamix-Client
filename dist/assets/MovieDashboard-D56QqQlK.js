import{r,b as N,l as S,a as j,j as e,M as _,R}from"./index-d7UcaRYF.js";import{m as $}from"./proxy-CMgvdZRE.js";function A({movieForm:a,setMovieForm:t}){const[c,u]=r.useState(!1),o=r.useRef(null),[n,l]=r.useState(null),[s,g]=r.useState([]),[b,y]=r.useState(!1),{token:f}=N(),h=r.useCallback(S.debounce(async p=>{try{const d=await j(`http://ecnet.website/api/genres/q/${p}`,{headers:{Authorization:`Bearer ${f}`},withCredentials:!0});if(!d.data.isAuthorized)return;g(d.data)}catch(d){console.error("Error fetching genres:",d)}finally{y(!1)}},300),[]);return r.useEffect(()=>{function p(d){o.current&&!o.current.contains(d.target)&&u(!1)}return c&&document.addEventListener("mousedown",p),()=>{document.removeEventListener("mousedown",p)}},[c]),r.useEffect(()=>()=>{h.cancel()},[h]),r.useEffect(()=>{y(!0),n?h(n):(h.cancel(),g([]),y(!1))},[n]),e.jsxs("div",{className:"",children:[e.jsx("button",{onClick:()=>u(!0),className:"w-8 h-8 rounded-full bg-gray-700 text-white flex items-center justify-center hover:bg-gray-600",title:"Add Genre",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})})}),c&&e.jsxs("div",{ref:o,className:"absolute flex flex-col overflow-scroll h-[300px] translate-y-[-100%] hide-scrollbar top-0 right-[50%] translate-x-[50%] z-50 bg-[#1f1f1f] text-white rounded-xl shadow-xl w-72",children:[e.jsxs("div",{className:"p-[1rem]",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Search Genre"}),e.jsx("input",{defaultValue:n,onChange:p=>{l(p.currentTarget.value)},type:"text",placeholder:"Type to search...",className:"w-full bg-black border border-white rounded-lg px-3 py-2 text-white focus:outline-none "})]}),b?e.jsx("div",{className:"flex items-center justify-center",children:"searching..."}):e.jsx("div",{className:"flex scrollbar-hide flex-col py-[1rem] gap-[1rem]",children:s.map(p=>e.jsx("div",{onClick:()=>{t({...a,genres:{...a.genres,[p.id]:p.genre}})},className:"hover:cursor-pointer px-[1rem] py-[0.5rem] bg-[#141414]/60",children:p.genre},p.id))})]})]})}function V({setMovieForm:a,movieForm:t,setOpenNewForm:c}){const u=r.useRef(null),{token:o}=N();return r.useEffect(()=>{function n(l){u.current.contains(l.target)||c(!1)}return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[]),e.jsxs("div",{ref:u,className:"backdrop-blur-md overflow-scroll flex flex-col gap-4 translate-y-[10%] h-[75vh] hide-scrollbar left-[50%] translate-x-[-50%] z-20 absolute text-white bg-[#141414] rounded-xl shadow-lg w-[75vw] p-[1rem]",children:[e.jsx("h2",{className:"text-xl font-bold",children:"New Movie"}),e.jsxs("div",{className:"flex flex-col gap-4 p-1 min-[950px]:grid min-[950px]:grid-cols-[25%_75%] ",children:[e.jsx("span",{className:"",children:"Title"}),e.jsx("input",{defaultValue:t.title,onBlur:n=>{a({...t,title:n.currentTarget.value})},className:"border px-[1rem] py-[0.2rem] border-white rounded-[0.7rem] w-full",type:"text"}),e.jsx("span",{className:"",children:"Description"}),e.jsx("textarea",{defaultValue:t.description,onBlur:n=>{a({...t,description:n.currentTarget.value})},className:"border h-[100px] px-[1rem] py-[0.2rem] border-white rounded-[0.7rem] resize-none w-full",type:"text"}),e.jsx("span",{children:"Duration"}),e.jsx("input",{defaultValue:t.duration,onBlur:n=>{a({...t,duration:n.currentTarget.value})},className:"border w-[100px] px-[1rem] py-[0.2rem] border-white rounded-[0.7rem]",type:"text"}),e.jsx("span",{children:"Release Date"}),e.jsx("input",{defaultValue:t.release_date,onBlur:n=>{a({...t,release_date:n.currentTarget.value})},className:"border w-[100px] px-[1rem] py-[0.2rem] border-white rounded-[0.7rem]",type:"text"}),e.jsx("span",{children:"Maturity Rating"}),e.jsx("input",{defaultValue:t.maturity_rating,onBlur:n=>{a({...t,maturity_rating:n.currentTarget.value})},className:"border w-[100px] px-[1rem] py-[0.2rem] border-white rounded-[0.7rem]",type:"text"}),e.jsx("span",{children:"Backdrop"}),e.jsx("input",{defaultValue:t.backdrop,onBlur:n=>{a({...t,backdrop:n.currentTarget.value})},className:"border w-full px-[1rem] py-[0.2rem] border-white rounded-[0.7rem]",type:"text"}),e.jsx("span",{children:"Video"}),e.jsx("input",{defaultValue:t.video,onBlur:n=>{a({...t,video:n.currentTarget.value})},className:"border w-full px-[1rem] py-[0.2rem] border-white rounded-[0.7rem]",type:"text"}),e.jsx("span",{className:"flex items-center",children:"Genres"}),e.jsxs("div",{className:"flex relative items-center gap-[1rem]",children:[Object.entries(t.genres).map(n=>e.jsx("button",{onClick:()=>{const l={...t.genres};delete l[n[0]],a({...t,genres:l})},className:"px-[1rem] hover:cursor-pointer py-[0.5rem] rounded-[0.7rem] bg-gray-600",children:n[1]},n[0])),e.jsx(A,{movieForm:t,setMovieForm:a})]}),e.jsx("button",{onClick:async()=>{console.log({...t,genres:Object.keys(t.genres)}),(await j.post("http://ecnet.website/api/movies",{movieForm:{...t,genres:Object.keys(t.genres)}},{headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},withCredentials:!0})).data.isAuthorized},className:"bg-blue-500 col-span-full hover:cursor-pointer text-white w-fit px-[1rem] mx-auto py-[0.5rem] rounded-[0.7rem]",children:"Add"})]})]})}function D({setMovieForm:a,movieForm:t,setOpenEdit:c,formDialog:u,setMovie:o}){const{token:n}=N(),l=r.useCallback(s=>{u.current.contains(s.target)||c(!1)});return r.useEffect(()=>{const s=setTimeout(()=>{document.addEventListener("mousedown",l)},0);return()=>{clearTimeout(s),document.removeEventListener("mousedown",l)}},[]),e.jsxs("div",{ref:u,className:"backdrop-blur-md overflow-scroll flex flex-col gap-4 h-[75vh] hide-scrollbar left-[50%] translate-x-[-50%] z-30 absolute text-white bg-[#141414] rounded-xl shadow-lg w-[75vw] p-[1rem]",children:[e.jsx("h2",{className:"text-xl font-bold",children:"New Movie"}),e.jsxs("div",{className:"flex flex-col gap-4 p-1 min-[950px]:grid min-[950px]:grid-cols-[25%_75%] ",children:[e.jsx("span",{className:"",children:"Title"}),e.jsx("input",{defaultValue:t.title,onBlur:s=>{a({...t,title:s.currentTarget.value})},className:"border px-[1rem] py-[0.2rem] border-white rounded-[0.7rem] w-full",type:"text"}),e.jsx("span",{className:"",children:"Description"}),e.jsx("textarea",{defaultValue:t.description,onBlur:s=>{a({...t,description:s.currentTarget.value})},className:"border h-[100px] px-[1rem] py-[0.2rem] border-white rounded-[0.7rem] resize-none w-full",type:"text"}),e.jsx("span",{children:"Duration"}),e.jsx("input",{defaultValue:t.duration,onBlur:s=>{a({...t,duration:s.currentTarget.value})},className:"border w-[100px] px-[1rem] py-[0.2rem] border-white rounded-[0.7rem]",type:"text"}),e.jsx("span",{children:"Release Date"}),e.jsx("input",{defaultValue:t.release_date,onBlur:s=>{a({...t,release_date:s.currentTarget.value})},className:"border w-[100px] px-[1rem] py-[0.2rem] border-white rounded-[0.7rem]",type:"text"}),e.jsx("span",{children:"Maturity Rating"}),e.jsx("input",{defaultValue:t.maturity_rating,onBlur:s=>{a({...t,maturity_rating:s.currentTarget.value})},className:"border w-[100px] px-[1rem] py-[0.2rem] border-white rounded-[0.7rem]",type:"text"}),e.jsx("span",{children:"Backdrop"}),e.jsx("input",{defaultValue:t.backdrop,onBlur:s=>{a({...t,backdrop:s.currentTarget.value})},className:"border w-full px-[1rem] py-[0.2rem] border-white rounded-[0.7rem]",type:"text"}),e.jsx("span",{children:"Video"}),e.jsx("input",{defaultValue:t.video,onBlur:s=>{a({...t,video:s.currentTarget.value})},className:"border w-full px-[1rem] py-[0.2rem] border-white rounded-[0.7rem]",type:"text"}),e.jsx("span",{className:"flex items-center",children:"Genres"}),e.jsxs("div",{className:"flex relative items-center gap-[1rem]",children:[Object.entries(t.genres).map(s=>e.jsx("button",{onClick:()=>{const g={...t.genres};delete g[s[0]],a({...t,genres:g})},className:"px-[1rem] hover:cursor-pointer py-[0.5rem] rounded-[0.7rem] bg-gray-600",children:s[1]},s[0])),e.jsx(A,{movieForm:t,setMovieForm:a})]}),e.jsx("button",{onClick:async()=>{const s=await j.put("http://ecnet.website/api/movies",{...t,genres:Object.keys(t.genres)},{headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},withCredentials:!0});s.data.isAuthorized&&(console.log(s.data),s.data.success&&o({...t}))},className:"bg-blue-500 col-span-full hover:cursor-pointer text-white w-fit px-[1rem] mx-auto py-[0.5rem] rounded-[0.7rem]",children:"Save"})]})]})}async function T(a,t,c){const u=await j.get(`http://ecnet.website/api/movies/${a}`,{headers:{Authorization:`Bearer ${token}`},withCredentials:!0});c(!1),u.data.isAuthorized&&t(u.data)}function L({id:a,setOpenInfo:t,deleteMovieUI:c}){const[u,o]=r.useState(!0),{token:n}=N(),[l,s]=r.useState({title:"",description:"",duration:"",release_date:"",maturity_rating:"",backdrop:"",video:"",genres:{}}),[g,b]=r.useState(!1),[y,f]=r.useState(l),h=r.useRef(null),p=r.useRef(null),d=r.useCallback(i=>{var w;!((w=h.current)!=null&&w.contains(i.target))&&h.current&&!p.current&&t(!1)},[]);async function k(){const i=await j.delete(`http://ecnet.website/api/movies/${a}`,{headers:{Authorization:`Bearer ${n}`},withCredentials:!0});i.data.isAuthorized&&i.data.status==204&&(t(!1),c(a))}return r.useEffect(()=>{T(a,s,o)},[a]),r.useEffect(()=>{f(l)},[l]),r.useEffect(()=>{const i=setTimeout(()=>{document.addEventListener("mousedown",d)},0);return()=>{document.removeEventListener("mousedown",d),clearTimeout(i)}},[]),u?e.jsx(_,{}):e.jsxs("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:[g&&e.jsx(D,{movieForm:y,setMovieForm:f,setOpenEdit:b,formDialog:p,fetchMovieInfo:T,setMovie:s}),e.jsxs("div",{ref:h,className:"flex w-[750px] m-[2rem] relative items-center justify-center",children:[e.jsxs("div",{className:" absolute z-20 top-0 right-0 flex py-[0.5rem] px-[1.2rem] gap-2",children:[e.jsx("button",{onMouseDown:()=>{b(!0)},className:" bg-green-600 rounded-[0.5rem] hover:cursor-pointer py-[0.5rem] px-[1.2rem]",children:"Edit"}),e.jsx("button",{onMouseDown:()=>{k()},className:" bg-red-600 rounded-[0.5rem] hover:cursor-pointer py-[0.5rem] px-[1.2rem]",children:"Delete"})]}),e.jsxs("div",{className:"bg-[#141414] relative overflow-scroll h-[75vh] hide-scrollbar rounded-2xl w-full",children:[e.jsx("div",{className:"absolute translate-y-[1rem] inset-0 bg-[linear-gradient(0deg,_#181818,_transparent_50%)]"}),e.jsx("img",{loading:"lazy",src:l.backdrop,className:"w-full aspect-video",alt:l.description}),e.jsxs("div",{className:"p-[2rem] absolute translate-y-[-6rem] w-full z-10 ",children:[e.jsx("h1",{className:"font-bold text-[1.5rem] w-fit",children:l.title}),e.jsxs("div",{className:"grid gap-[1rem] grid-cols-[65%_35%]",children:[e.jsxs("div",{className:"flex flex-col gap-[1rem] text-[#bcbcbc]",children:[e.jsxs("div",{className:"flex gap-[1rem]",children:[e.jsx("div",{children:l.release_date}),e.jsxs("div",{children:[l.duration,"m"]})]}),e.jsx("p",{children:l.description})]}),e.jsx("div",{className:"flex flex-col p-1",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("span",{className:" mr-1 mb-1",children:"Genres:"}),Object.entries(l.genres).map(i=>e.jsx("span",{className:"text-[#bcbcbc]",children:i[1]},i[0]))]})})]})]})]})]})]})}function G({selectedGenre:a,query:t,movies:c,setMovies:u,nextPart:o,loading:n,setNextPart:l,setLoading:s}){const[g,b]=r.useState(!1),[y,f]=r.useState(null),{token:h}=N(),p=r.useRef(null),d=r.useRef(null),k=r.useCallback(i=>{u(w=>w.filter(x=>x.id!==i))},[]);return r.useEffect(()=>{if(!d.current||o==null)return;const i=new IntersectionObserver(async([w])=>{if(w.isIntersecting&&o){i.unobserve(d.current),s(!0);const x=await j.get(`http://ecnet.website/api/movies?part=${o}&genre=${a}&title=${t}`,{headers:{Authorization:`Bearer ${h}`},withCredentials:!0});if(s(!1),!x.data.isAuthorized)return;l(x.data.next_part),u(z=>[...z,...x.data.movies])}},{root:p.current,threshold:.1});return i.observe(d.current),()=>{i.disconnect()}},[o]),console.log("movie container"),e.jsxs("div",{ref:p,className:"grid h-[65vh] relative border p-[1rem] mt-[1rem] border-white rounded-[1rem] overflow-scroll gap-4 hide-scrollbar grid-cols-1 min-[500px]:grid-cols-2 min-[1000px]:grid-cols-3",children:[g&&e.jsx(L,{id:y,setOpenInfo:b,deleteMovieUI:k}),c.map((i,w)=>c.length==w+1?e.jsxs("div",{onClick:x=>{f(i.id),b(!0)},ref:d,className:" h-fit hover:cursor-pointer flex flex-col ",children:[e.jsx("img",{loading:"lazy",src:i.backdrop,className:"aspect-video w-full",alt:i.description}),e.jsx("div",{children:i.title})]},i.id):e.jsxs("div",{onClick:x=>{f(i.id),b(!0)},className:" h-fit hover:cursor-pointer flex flex-col ",children:[e.jsx("img",{className:"aspect-video",src:i.backdrop,alt:i.description}),e.jsx("div",{children:i.title})]},i.id)),n&&e.jsx("div",{children:"Loading..."})]})}const M=R.memo(G);function O({setSelectedGenre:a,genres:t,setOpenGenre:c,genreRef:u}){const o=r.useRef(null),n=r.useCallback(l=>{if(o.current&&!o.current.contains(l.target)){if(l.target==u.current)return;c(!1)}},[]);return r.useEffect(()=>{const l=setTimeout(()=>{document.addEventListener("mousedown",n)},0);return()=>{document.removeEventListener("mousedown",n),clearTimeout(l)}},[]),console.log("genre selection"),e.jsx("div",{ref:o,className:"grid gap-4 grid-cols-3 top-[100%] z-30 bg-black absolute",children:t.map(l=>e.jsx("div",{onClick:()=>{a(l.genre),c(!1)},className:"p-[0.5rem] hover:cursor-pointer",children:l.genre},l.id))})}const I={title:"",description:"",duration:"",release_date:"",maturity_rating:"",backdrop:"",video:"",genres:{}};function U(){const[a,t]=r.useState([]),{token:c}=N(),[u,o]=r.useState(!1),[n,l]=r.useState(!1),[s,g]=r.useState(""),[b,y]=r.useState(I),[f,h]=r.useState(""),[p,d]=r.useState([]),[k,i]=r.useState(null),[w,x]=r.useState(!1),z=r.useRef(null),E=r.useRef(null),B=S.debounce(async function(){x(!0),d([]);const m=await j.get(`http://ecnet.website/api/movies?genre=${s}&title=${f}`,{headers:{Authorization:`Bearer ${c}`},withCredentials:!0});x(!1),m.data.isAuthorized&&(d(m.data.movies),i(m.data.next_part))},300);return r.useEffect(()=>(B(),()=>{B.cancel()}),[f]),r.useEffect(()=>{async function m(){if(!s)return;x(!0),d([]);const C=await j.get(`http://ecnet.website/api/movies?genre=${s}&title=${f}`,{headers:{Authorization:`Bearer ${c}`},withCredentials:!0});x(!1),C.data.isAuthorized&&(d(C.data.movies),i(C.data.next_part))}m()},[s]),r.useEffect(()=>{async function m(){const v=await j.get("http://ecnet.website/api/genres/main",{headers:{Authorization:`Bearer ${c}`},withCredentials:!0});v.data.isAuthorized&&t(v.data)}async function C(){x(!0);const v=await j.get("http://ecnet.website/api/movies",{headers:{Authorization:`Bearer ${c}`},withCredentials:!0});x(!1),v.data.isAuthorized&&(d(v.data.movies),i(v.data.next_part))}C(),m()},[]),console.log("dashboard"),e.jsxs($.div,{initial:{opacity:1},exit:{opacity:0,transition:{duration:1.2}},className:"bg-[#141414] relative min-h-screen select-none",children:[u&&e.jsx(V,{setMovieForm:y,movieForm:b,setOpenNewForm:o}),e.jsxs("div",{className:"z-10 p-[1rem] flex relative gap-[2rem] text-white",children:[e.jsx("h1",{className:"font-bold text-[1.5rem] text-nowrap",children:"Movie Dashboard"}),e.jsx("input",{value:f,onChange:m=>{h(m.currentTarget.value)},className:"h-[2rem] px-[1rem] shrink items-center min-w-0 rounded-lg border border-gray-300 focus:outline-none ",type:"text",placeholder:"Search"})]}),e.jsxs("div",{className:"relative p-[2rem] z-10 text-white",children:[e.jsxs("div",{className:"flex items-center relative gap-[1rem]",children:[e.jsx("h1",{ref:E,onMouseDown:m=>{n||l(!0)},className:"border font-bold rounded-[0.7rem] border-white px-[1rem] py-[0.5rem] select-none hover:cursor-pointer",children:s||"Genres"}),n&&e.jsx(O,{genreRef:E,setSelectedGenre:g,setOpenGenre:l,genres:a}),e.jsx("div",{onMouseDown:m=>{m.stopPropagation(),o(!0)},ref:z,className:"font-bold hover:cursor-pointer px-[1rem] py-[0.5rem] bg-green-600 rounded-[0.7rem]",children:"New Movie"})]}),e.jsx(M,{query:f,selectedGenre:s,movies:p,setMovies:d,loading:w,nextPart:k,setNextPart:i,setLoading:x})]})]})}export{U as default};
