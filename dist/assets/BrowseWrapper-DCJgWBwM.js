import{r as s,b as j,a as x,j as r,e as C,f as E}from"./index-d7UcaRYF.js";import{m as y}from"./proxy-CMgvdZRE.js";function S({genre:i,setGenre:o}){const[g,l]=s.useState([]),[h,n]=s.useState(!1),{token:c}=j(),a=s.useRef(null);return s.useEffect(()=>{x.get("http://ecnet.website/api/genres/main",{headers:{Authorization:`Bearer ${c}`},withCredentials:!0}).then(e=>{e.data.isAuthorized&&l(e.data)}).catch(e=>console.error("Error fetching genres:",e))},[]),s.useEffect(()=>{const e=p=>{a.current&&!a.current.contains(p.target)&&n(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),r.jsxs("div",{className:"text-white flex items-baseline gap-2",children:[r.jsx("h1",{onClick:()=>{i&&o("")},className:`font-bold text-[clamp(1rem,3vw,3rem)] ${i&&"hover:cursor-pointer hover:text-white/75"}`,children:"Movie"}),r.jsxs("div",{className:"relative w-full",ref:a,children:[r.jsx("button",{onClick:()=>n(e=>!e),className:"text-[clamp(0.5rem,2vw,2rem)] hover:cursor-pointer px-[clamp(0.5rem,2vw,1rem)] border border-white bg-black text-white",children:i||"Genre"}),h&&r.jsx("div",{className:"absolute text-[clamp(0.5rem,2vw,2rem)] bg-black translate-y-[100%] left-0 top-0 grid grid-cols-3 z-20 border border-white p-2 gap-2",children:g.map(e=>r.jsx("span",{onClick:()=>{o(e.genre),n(!1)},className:"text-white hover:bg-white/25 px-2 py-1 cursor-pointer rounded transition",children:e.genre},e.id))})]})]})}function A(){const[i,o]=s.useState([]),[g,l]=s.useState(null),[h,n]=s.useState(!0),[c,a]=s.useState(null),[e,p]=s.useState(""),[N,w]=s.useState(null),[f,m]=s.useState(!1),{token:b}=j(),d=s.useRef(null);return s.useEffect(()=>{if(!d.current||!c)return;const t=new IntersectionObserver(([v])=>{v.isIntersecting&&(t.unobserve(d.current),n(!0),x.get(`http://ecnet.website/api/movies?part=${c}&genre=${e}`,{headers:{Authorization:`Bearer ${b}`},withCredentials:!0}).then(u=>{n(!1),u.data.isAuthorized&&(o(k=>[...k,...u.data.movies]),l(u.data.current_part),a(u.data.next_part))}))},{threshold:.1});return t.observe(d.current),()=>{t.disconnect()}},[c,e]),s.useEffect(()=>{o([]),n(!0),x.get(`http://ecnet.website/api/movies?genre=${e}`,{headers:{Authorization:`Bearer ${b}`},withCredentials:!0}).then(t=>{n(!1),t.data.isAuthorized&&(o(t.data.movies),l(t.data.current_part),a(t.data.next_part))}).catch(t=>{console.error(t)})},[e]),s.useEffect(()=>(f?document.body.style.overflow="hidden":document.body.style.overflow="auto",()=>{document.body.style.overflow="auto"}),[f]),r.jsxs(y.div,{initial:{opacity:1},exit:{opacity:0,transition:{duration:1.2}},className:"bg-[#141414] relative min-h-screen select-none",children:[f&&r.jsx(C,{id:N,setOpenInfo:m}),r.jsxs("div",{className:"absolute w-screen flex flex-col gap-[1rem] overflow-hidden p-[1.5rem] left-[0] top-[clamp(2rem,5vw,6rem)]",children:[r.jsx(S,{setMovies:o,genre:e,setGenre:p}),r.jsxs("div",{className:"grid grid-cols-2 h-[65vh] gap-2 min-[768px]:grid-cols-4 overflow-scroll hide-scrollbar",children:[i.map((t,v)=>i.length===v+1?r.jsx("div",{onClick:()=>{w(t.id),m(!0)},ref:d,children:r.jsx("img",{className:"aspect-video hover:cursor-pointer w-full",src:t.backdrop,alt:t.description})},t.id):r.jsx("div",{onClick:()=>{w(t.id),m(!0)},children:r.jsx("img",{className:"aspect-video hover:cursor-pointer w-full",src:t.backdrop,alt:t.description})},t.id)),h&&r.jsx("div",{className:"text-white",children:"Loading..."})]})]})]})}function $(){return r.jsx(E.KeepAlive,{children:r.jsx(A,{})})}export{$ as default};
